#!/usr/bin/env python
# -*- coding: utf-8 -*-
import sys
import glob
import json
import os
from collections import OrderedDict

if len(sys.argv) != 2:
    print("")
    print("Must indicate a folder generated by Metascreener for example:")
    print("print  MetaScreener/extra_metascreener/get_csv.py BD_AD_1le0_GLA_2018-07-25/")
    print ("")
    exit()

data={}
cnt_json=0
json_files = "/energies/*.json"
directory = sys.argv[1]
for f_json in glob.glob(directory+json_files):
    with open(f_json) as f:
        d = json.load(f)
    if d['global_score'] != "":
        data [cnt_json] = [ float( d['global_score'] ),float(d['coords'][0]),float(d['coords'][1]),float(d['coords'][2]),str(os.path.splitext(os.path.basename(d['file_ori_query']))[0]),int(d['num_execution']) ]
        cnt_json += 1
data=OrderedDict(sorted(data.items(), key=lambda t: t[1][0]))
file = open(os.path.join(directory+"/Results_scoring.csv"), "w")
file.write("Global score;x;y;z;Querie;Num_execution\n")
for i, k in data.items():
    file.write(str(k)[1:-1].replace(', ', ';').replace("'", "")+"\n")
file.close()
